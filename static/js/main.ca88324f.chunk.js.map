{"version":3,"sources":["../node_modules/peerjs/dist sync","store/index.ts","Drop/index.tsx","File/index.tsx","Header/Header.tsx","Share/index.tsx","App.tsx","index.tsx"],"names":["webpackEmptyContext","req","e","Error","code","keys","resolve","module","exports","id","Actions","store","createStore","state","files","fileName","action","type","ADD_FILE","payload","SET_FILE_NAME","useAppDispatch","useDispatch","useAppSelector","useSelector","Drop","useState","hover","setHover","dispatch","className","onDragEnter","preventDefault","stopPropagation","onDragLeave","onDragOver","onDrop","Array","from","dataTransfer","forEach","file","FileCard","askForSend","parent","index","onClick","send","Header","Share","peerId","size","value","window","location","href","downloadFile","name","fileContent","link","document","createElement","download","URL","createObjectURL","Blob","click","App","setPeerId","parentPeer","setParentPeer","childPeer","setChildPeer","parentFiles","setParentFiles","storeFiles","useEffect","peer","Peer","URLSearchParams","split","get","hasParent","on","conn","connect","data","console","log","ArrayBuffer","getState","setTimeout","prev","a","map","length","ReactDOM","render","StrictMode","getElementById"],"mappings":"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","file":"static/js/main.ca88324f.chunk.js","sourcesContent":["function webpackEmptyContext(req) {\n\tvar e = new Error(\"Cannot find module '\" + req + \"'\");\n\te.code = 'MODULE_NOT_FOUND';\n\tthrow e;\n}\nwebpackEmptyContext.keys = function() { return []; };\nwebpackEmptyContext.resolve = webpackEmptyContext;\nmodule.exports = webpackEmptyContext;\nwebpackEmptyContext.id = 29;","import { createStore } from 'redux'\nimport { TypedUseSelectorHook, useDispatch, useSelector } from 'react-redux'\n\nexport enum Actions {\n  ADD_FILE = 'ADD_FILE',\n  SET_FILE_NAME = 'SET_FILE_NAME',\n}\n\nfunction counterReducer(\n  state: { files: File[]; fileName: string } = { files: [], fileName: '' },\n  action: { type: Actions; payload?: any }\n) {\n  switch (action.type) {\n    case Actions.ADD_FILE:\n      return {\n        ...state,\n        files: [...state.files, action.payload],\n      }\n    case Actions.SET_FILE_NAME:\n      return {\n        ...state,\n        fileName: action.payload,\n      }\n    default:\n      return state\n  }\n}\n\nexport let store = createStore(counterReducer)\n\n// Infer the `RootState` and `AppDispatch` types from the store itself\nexport type RootState = ReturnType<typeof store.getState>\nexport type AppDispatch = typeof store.dispatch\n\n// Use throughout your app instead of plain `useDispatch` and `useSelector`\nexport const useAppDispatch = () => useDispatch<AppDispatch>()\nexport const useAppSelector: TypedUseSelectorHook<RootState> = useSelector\n","import { useState } from 'react'\nimport { Actions, useAppDispatch } from '../store'\n\nexport const Drop = () => {\n  const [hover, setHover] = useState(false)\n\n  const dispatch = useAppDispatch()\n\n  return (\n    <>\n      <div\n        className={`h-96 rounded-md ${\n          hover ? 'bg-gray-200' : 'bg-gray-100'\n        } flex items-center justify-center p-4`}\n        onDragEnter={(e) => {\n          e.preventDefault()\n          e.stopPropagation()\n\n          setHover(true)\n        }}\n        onDragLeave={(e) => {\n          e.preventDefault()\n          e.stopPropagation()\n\n          setHover(false)\n        }}\n        onDragOver={(e) => {\n          e.preventDefault()\n          e.stopPropagation()\n        }}\n        onDrop={(e) => {\n          e.preventDefault()\n          e.stopPropagation()\n\n          setHover(false)\n          const dragFiles = Array.from(e.dataTransfer.files)\n          dragFiles.forEach((file) =>\n            dispatch({ type: Actions.ADD_FILE, payload: file })\n          )\n        }}\n      >\n        <p>Drag a file here to send it</p>\n      </div>\n    </>\n  )\n}\n","import { DataConnection } from 'peerjs'\nimport { FC } from 'react'\nimport { Download } from 'react-feather'\nimport { Actions, useAppDispatch } from '../store'\n\nexport const FileCard: FC<{\n  fileName: string\n  index: number\n  askForSend: boolean\n  parent: DataConnection | null\n}> = ({ fileName, askForSend, parent, index }) => {\n  const dispatch = useAppDispatch()\n\n  return (\n    <div className=\"mb-2 bg-gray-100 rounded-md flex flex-row p-4 justify-between items-center\">\n      <div>{fileName}</div>\n\n      {askForSend && parent && (\n        <button\n          className=\"text-white stroke-current bg-gradient-to-br p-2 rounded from-green-400 to-blue-500\"\n          onClick={() => {\n            dispatch({ type: Actions.SET_FILE_NAME, payload: fileName })\n            parent.send({ type: 'requestFile', index })\n          }}\n        >\n          <Download />\n        </button>\n      )}\n    </div>\n  )\n}\n","export const Header = () => {\n  return (\n    <header className=\"mb-2\">\n      <h1>Drop</h1>\n    </header>\n  )\n}\n","import { FC } from 'react'\nimport QRCode from 'react-qr-code'\n\nexport const Share: FC<{ peerId: string }> = ({ peerId }) => {\n  return (\n    <div className={`flex flex-row gap-8 mb-8 p-4 items-center`}>\n      <QRCode\n        className=\"\"\n        size={128}\n        value={`${window.location.href}?peer=${peerId}`}\n      />\n\n      <div>\n        Scan this qrcode to receive the file <br /> or use{' '}\n        <a\n          href={`${window.location.href}?peer=${peerId}`}\n          className=\"text-blue-800 underline\"\n        >\n          this link\n        </a>\n      </div>\n    </div>\n  )\n}\n","import Peer, { DataConnection } from 'peerjs'\nimport { useEffect, useState } from 'react'\nimport { Drop } from './Drop'\nimport { FileCard } from './File'\nimport { Header } from './Header/Header'\nimport { Share } from './Share'\nimport { store, useAppSelector } from './store'\n\nfunction downloadFile(name: string, fileContent: ArrayBuffer) {\n  const link = document.createElement('a')\n  link.download = name\n  link.href = URL.createObjectURL(new Blob([fileContent]))\n  link.click()\n}\n\nfunction App() {\n  const [peerId, setPeerId] = useState<string | null>(null)\n\n  const [parentPeer, setParentPeer] = useState<DataConnection | null>(null)\n  const [childPeer, setChildPeer] = useState<DataConnection[]>([])\n  const [parentFiles, setParentFiles] = useState<\n    { name: string; size: number }[]\n  >([])\n\n  const storeFiles = useAppSelector((store) => store.files)\n\n  useEffect(() => {\n    const peer = new Peer()\n\n    const urlParams = new URLSearchParams(window.location.href.split('?')[1])\n    const peerId = urlParams.get('peer')\n    const hasParent = !!peerId\n\n    peer.on('open', (id) => {\n      setPeerId(id)\n\n      // We want to broadcast files to the children peer if we are a parent\n      if (!hasParent) {\n        peer.on('connection', (conn) => {\n          setTimeout(() => setChildPeer((prev) => [...prev, conn]), 10)\n\n          conn.on('data', async (data) => {\n            if (data.type === 'requestFile') {\n              const file = store.getState().files[data.index]\n\n              conn.send(file)\n            }\n          })\n        })\n      } else {\n        // Otherwise, we want to listen to file broadcasts from the parent\n        const conn = peer.connect(peerId)\n        setParentPeer(conn)\n        conn.on('data', (data) => {\n          console.log(data)\n\n          if (data instanceof ArrayBuffer) {\n            downloadFile(store.getState().fileName, data)\n            return\n          }\n\n          if (data.type === 'files') {\n            setParentFiles(data.files)\n          }\n\n          if (data.type === 'file') {\n            downloadFile(data.name, data.file)\n          }\n        })\n      }\n    })\n  }, [])\n\n  useEffect(() => {\n    const files = storeFiles.map((file) => ({\n      name: file.name,\n      size: file.size,\n    }))\n\n    for (const conn of childPeer) {\n      conn.send({\n        type: 'files',\n        files,\n      })\n    }\n  }, [storeFiles, childPeer])\n\n  let files\n\n  if (parentFiles.length > 0) {\n    files = parentFiles\n  } else {\n    files = storeFiles.map((file) => ({\n      name: file.name,\n      size: file.size,\n    }))\n  }\n\n  return (\n    <div className=\"max-w-screen-md mx-auto p-4\">\n      <Header />\n\n      {peerId && storeFiles.length > 0 && <Share peerId={peerId} />}\n\n      {files.map((file, index) => (\n        <FileCard\n          parent={parentPeer}\n          fileName={file.name}\n          index={index}\n          key={index}\n          askForSend={parentPeer !== null}\n        />\n      ))}\n\n      <Drop />\n    </div>\n  )\n}\n\nexport default App\n","import React from 'react'\nimport ReactDOM from 'react-dom'\nimport './index.css'\nimport App from './App'\nimport { Provider } from 'react-redux'\nimport { store } from './store'\n\nReactDOM.render(\n  <React.StrictMode>\n    <Provider store={store}>\n      <App />\n    </Provider>\n  </React.StrictMode>,\n  document.getElementById('root')\n)\n"],"sourceRoot":""}